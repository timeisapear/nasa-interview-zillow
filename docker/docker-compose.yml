version: '3.8'

services:
  panel_app:
    build:
      context: ../
      dockerfile: Dockerfile
    ports:
      - "7860:7860"
    volumes:
      - ../nasa_interview_project:/code
      - ../Makefile:/code/Makefile
    environment:
      - PYTHONPATH=/code/
    command: ["panel", "serve", "/code/pipeline/visualize.py", "--address", "0.0.0.0", "--port", "7860",  "--allow-websocket-origin", "*", "--num-procs", "2", "--num-threads", "0"]

  run_pipeline:
    build:
      context: ../
      dockerfile: Dockerfile
    volumes:
      - ../nasa_interview_project:/code
      - ../Makefile:/code/Makefile
    environment:
      - PYTHONPATH=/code/
    command: ["make", "analyze"]